define(function(require){require("lib/pretty/prettify.js"),require("lib/pretty/prettify.css"),require("/static/lib/lazyload/jquery.lazyload.js"),require("/static/lib/ueditor/ueditor.parse.js"),require("/static/lib/layer/1.6.0/layer.min.js"),require("/static/lib/layer/1.6.0/skin/layer.css"),require("/static/lib/ueditor/themes/imooc/css/ueditor.css"),require("/static/page/article/addCopy.js"),require("/static/moco/v1.0/dist/js/moco.min.js"),require("/static/page/course/common/course_tipoff.js"),require("/static/page/article/discoverycount.js");{var Cookie=(require("/static/page/article/praise.js"),require("/static/component/base/util/cookie.js")),Common=require("/static/page/discovery/common.js");require("../common/verify-code.js")}prettyPrint&&prettyPrint();var addFollow,_dom=document,isFollowAjax=0,bindEventFuns={followIconClick:function(){var a=$(this),c=a.data("type"),v=a.data("uid"),g=$(".js-already-follow");isFollowAjax||(OP_CONFIG.userInfo?(isFollowAjax=1,1==c&&addFollow({url:"/u/"+OP_CONFIG.userInfo.uid+"/ajaxfollows",uid:v,type:1},function(){a.hide(),g.show(),usersInfoCache&&usersInfoCache[v]&&(usersInfoCache[v].is_follows=1)})):require.async("login_sns",function(a){a.init()}))},cancelFollowClick:function(){var a=$(this),c=a.data("uid"),v=$(".js-add-follow");addFollow({url:"/u/"+OP_CONFIG.userInfo.uid+"/ajaxfollows",uid:c,type:2},function(){a.hide(),v.show(),usersInfoCache&&usersInfoCache[c]&&(usersInfoCache[c].is_follows=0)})}};addFollow=function(a,c){var v={ok:{v:1101,_msg:"关注成功"},error:{v:1100,_msg:"关注失败"}},g={ok:{v:1201,_msg:"取消成功"},error:{v:1200,_msg:"取消失败"}};$.ajax({type:"post",url:a.url,dataType:"json",data:{uid:a.uid,type:a.type},success:function(a){a&&a.result&&(a.result==v.ok.v?c&&c():a.result==v.error.v?layer.msg(a.msg?a.msg:v.error._msg,1,1):a.result==g.ok.v?c&&c():a.result==g.error.v?layer.msg(a.msg?a.msg:g.error._msg,1,1):layer.msg(a.msg,1,1))},error:function(){layer.msg("网络错误，请稍后再试",1,1)},complete:function(){isFollowAjax=0}})},$(_dom).on("click",".js-add-follow",bindEventFuns.followIconClick),$(_dom).on("click",".js-already-follow",bindEventFuns.cancelFollowClick),$(".js-already-follow").hover(function(){$(".js-already-follow").html("取消关注")},function(){$(".js-already-follow").html("已关注")});var showPraiseUser=function(){$.ajax({url:"/article/getupvoteusers?id="+pageInfo.id,type:"get",dataType:"json",success:function(a){if(1===a.result){var c=a.data;if(0==c.length)$(".show-praise-wrap").css({opacity:"0",height:"0px","margin-bottom":"0px"});else for(var i=0;i<c.length;i++)$("#js-praise-show").append('<li class="l"><a target="_blank" href="/u/'+c[i].uid+'/articles">                                                <img src="'+c[i].img+'" title="'+c[i].nickname+'"/>                                                </a></li>')}},complete:function(){}})},showAuthors=function(){$.ajax({url:"/article/getuser?uid="+authorUid.uid,type:"get",dataType:"json",success:function(a){0===a.result&&($(".js-article-num").find("span").text(a.data.article),$(".js-article-words").find("span").text(a.data.countwords))},complete:function(){}})},loadRelateCourse=function(a,c){var v=pageInfo.id||"";$.ajax({type:"get",url:a,dataType:"json",data:{id:v},success:function(a){var v;0==a.result&&(v=a.data,c&&c(v))},error:function(){layer.msg("网络错误，请稍后再试",1,8)}})};loadRelateCourse("/article/ajaxrelatecourse",function(d){var a='<div class="title">相关课程</div><ul class="moco-aside-course">';$.each(d,function(i,c){a+="<li>";var v='<div class="aside-course-img">';v+="undefined"!=typeof c.pic&&null!=c.pic?'<img src="'+c.pic+'">':'<img src="//www.imooc.com/courseimg/s/cover015_s.jpg">',a+=v,"实战"==c.course_type?a+='<p class="aside-course-type">'+c.course_type+"</p>":"路径"==c.course_type&&(a+='<p class="aside-course-type">就业班</p>'),a+="</div>",a+='<div class="aside-course-content">';var g='<a href="//www.imooc.com/learn/'+c.id+c.channelurl+'" class="aside-course-name" target="_blank">';"实战"==c.course_type?g='<a href="//coding.imooc.com/class/'+c.id+".html"+c.channelurl+'" class="aside-course-name" target="_blank">':"路径"==c.course_type&&(g='<a href="//class.imooc.com/sc/'+c.id+c.channelurl+'" class="aside-course-name" target="_blank">'),g+=c.name+"</a>",a+=g,c.show_price_info&&(a+='<p class="aside-course-price">',a+=1==c.show_price_info.is_show_discount_price||2==c.show_price_info.discount_type?'<span class="aside-discount-price">￥'+(c.show_price_info.discount_price+"").split(".")[0]+"</span>":"<span>￥"+(c.show_price_info.price+"").split(".")[0]+"</span>",c.show_price_info.discount_type&&2==c.show_price_info.discount_type&&(a+='<span class="aside-discount-intro">学生惠</span>'),a+="</p>",a+='<div class="aside-course-dot">',a+='<i class="imv2-dot_samll"></i>',a+="</div>"),"路径"==c.course_type&&(a+='<p class="aside-course-grade">',a+=c.step+"步骤/"+c.coursecount+"门课",a+="</p>",a+='<div class="aside-course-dot">',a+='<i class="imv2-dot_samll"></i>',a+="</div>"),c.easy_type&&(a+='<p class="aside-course-grade">',a+=c.easy_type,a+="</p>",a+='<div class="aside-course-dot">',a+='<i class="imv2-dot_samll"></i>',a+="</div>"),a+='<p class="aside-course-people">',a+='<i class="imv2-set-sns"></i>',a+="<span>"+c.numbers+"</span>",a+="</p>",a+="</div>",a+="</li>"}),a+="</ul>",$(".js-related_lessons").empty().append(a),$(".js-hover-name").hover(function(){$(this).removeClass("oneLine").addClass("hoverClass").siblings().addClass("marginTop")},function(){$(this).addClass("oneLine").removeClass("hoverClass").siblings().removeClass("marginTop")})}),$(".font-info").hover(function(){$(this).addClass("active-font"),$(this).find(".font-box-s").removeClass("hide")},function(){$(this).removeClass("active-font"),$(this).find(".font-box-s").addClass("hide")}),$("p",".font-box-s").on("click",function(){var a=$(this).data("size-f"),c=$(".size-show");$("p",".font-box-s").removeClass("s-font"),$(this).addClass("s-font"),$(".font-box-s").addClass("hide"),$(".detail-content").removeClass("big-size-f").removeClass("sm-size-f").removeClass("md-size-f"),$(".detail-content").addClass(a),Cookie&&Cookie.set("article-font-set",a,30),a&&-1!=a.indexOf("sm")&&c.text("小字号"),a&&-1!=a.indexOf("md")&&c.text("中字号"),a&&-1!=a.indexOf("big")&&c.text("大字号")});var loadingFontSize=function(){var a,c;c=$(".size-show",".font-warp"),a=Cookie&&Cookie.get("article-font-set"),$("p",".font-box-s").removeClass("s-font"),(a&&-1!=a.indexOf("sm")||!a)&&c.text("小字号"),a&&-1!=a.indexOf("md")&&c.text("中字号"),a&&-1!=a.indexOf("big")&&c.text("大字号"),$("p[data-size-f='"+a+"']",".font-box-s").addClass("s-font")};loadingFontSize();var checkPraised=function(){$("#js-praise").find("span").hasClass("praised")&&($("#js-praise-bottom").css("background","#ffaa00"),$("#js-praise-left").css("background","#ffaa00"),$("#js-praise").css("background","#ffaa00"))};checkPraised(),$(".praise-box>button").click(function(){if(!OP_CONFIG.userInfo)return void seajs.use("login_sns",function(a){a.init()});var a=$(".praise-box").find("span"),p=a.hasClass("praised");$("#js-praise").hasClass("loading")||($("#js-praise").addClass("loading"),$.ajax({url:"/article/ajaxupvote",type:"post",dataType:"json",data:{article_id:pageInfo.id},success:function(a){if(0===a.result&&!p){$("#js-praise-bottom").css("background","#ffaa00").find("span").addClass("praised"),$("#js-praise-left").css("background","#ffaa00").find("span").addClass("praised"),$("#js-praise").css("background","#ffaa00").find("span").addClass("praised");var c=$(".praise-box .num-person .num, .praise-box .praise-num"),v=parseInt(pageInfo.praiseNum);v+=1,c.html(v),$(".praise-share").removeClass("hide")}},complete:function(){$("#js-praise").removeClass("loading")}}))});var calcCodePreviewHeight=function(){$(".code-preview-box").length&&$(".code-preview-box pre").css("max-height",.9*window.innerHeight-48+"px")},initCodePreview=function(){$(document).on("mouseenter",".detail-content .cl-preview-section:not(.code-preview-box) pre",function(e){var a=$(e.currentTarget);a.children("#code-preview").length?$("#code-preview",a).show():a.append('<span id="code-preview">预览</span>')}).on("mouseleave",".detail-content .cl-preview-section:not(.code-preview-box) pre",function(e){var a=$(e.currentTarget);$("#code-preview",a).hide()}).on("click",".detail-content #code-preview",function(e){var a=$(e.currentTarget),c=a.parents(".cl-preview-section").clone();c.prepend('                                        <span class="code-preview-title">                                            代码预览                                            <i class="imv2-fullscreen_exit js-close-codepreview" title="关闭预览"></i>                                        </span>').find("#code-preview").remove(),$("body").addClass("moco-modal-body").append('<div class="code-preview-modal"></div>'),a.parents(".detail-content > div").append(c.addClass("code-preview-box")),calcCodePreviewHeight(),$(".code-preview-modal, .code-preview-box").fadeIn(100),$(window).on("resize.code-preview",calcCodePreviewHeight)}).on("click",".code-preview-title .js-close-codepreview",function(){$("body").removeClass("moco-modal-body"),$(".code-preview-modal, .code-preview-box").fadeOut(100,function(){$(".code-preview-modal, .code-preview-box").remove()}),$(window).off("resize.code-preview")})};if($(".js-showcommentModal").on("click",function(){return OP_CONFIG.userInfo?void initcommentModal():void seajs.use("login_sns",function(a){a.init()})}),1==isLogin)var _class="js-ci-inner";else var _class="js-ci-unlogin";var dialog,initcommentModal=function(){var a=['<div class="df-text">','<div id="js-reply-editor-box" class="wd-comment-box ',_class,'"></div>','<p id="feed-error" class="feed-error"></p>','<div class="df-bottom clearfix">','<div class="captcha-verify-box js-comment-verify-box hide"></div>','<button id="js-submit" class="comment-btn r">提交</button>',"</div>","</div>"].join("");if(dialog=$.dialog(a,{title:"发评论",width:"704px",height:"324px",modal:!0}),1==isLogin){var c={initialFrameHeight:120,initialFrameWidth:"auto",autoHeightEnabled:!1};UE.delEditor("js-reply-editor-box");{var v=UE.getEditor("js-reply-editor-box",c);$(".pop-tips-layer")}v.addListener("focus",function(){util.msg.call($("#js-reply-editor-box"))}),v.addListener("keydown",function(a,c){13==c.keyCode&&c.ctrlKey&&$("#js-submit").trigger("click")}),$(".verify-code input").on("keydown",function(a){a.ctrlKey&&13==a.keyCode&&$("#js-submit").trigger("click")})}};$(document).on("click","#js-submit",function(e){e.preventDefault();var a,c,v=$(this);if(!v.hasClass("loading")){if(c=$.trim(UE.getEditor("js-reply-editor-box").getContent()),a=UE.getEditor("js-reply-editor-box").getContentLength(!0),1>a)return $("#feed-error").text("评论内容不能为空！"),void clearVerify($(".js-comment-verify-box"));if(a>400)return $("#feed-error").text("评论字数不能超过400个字！"),void clearVerify($(".js-comment-verify-box"));$("#feed-error").text("");var g={};g.article_id=pageInfo.id,g.content=c,"undefined"!=typeof token&&""!=token&&(g.token=token),v.addClass("loading").text("正在提交..."),$.ajax({url:"/article/ajaxpostcomment",type:"post",dataType:"json",data:g,success:function(a){0===a.result?window.location.reload():1===a.data&&-1===a.result?(0!=$(".js-reply-verify-box").length&&clearVerify($(".js-reply-verify-box")),$(".js-comment-verify-box").removeClass("hide"),moVerify=new mocaptcha(".js-comment-verify-box",{type:0,success:function(t){token=t,v.trigger("click")}}),$(".js-mocaptcha").append('<span class="js-mocaptcha-close imv2-close"></span>')):-103002==a.result?(moVerify.reset(),token=""):($("#feed-error").html(a.msg),""!=moVerify?(moVerify.reset(),token=""):clearVerify($(".js-comment-verify-box")))},complete:function(){v.removeClass("loading"),parsingLag()}})}}),$(".qa-comment-page").on("click",".js-more",function(){loadFeedback($(this).attr("data-page"),!0)});var _replyFlag,loadFeedback=function(a,c){a=parseInt(a||1),$.ajax({url:"/article/ajaxcomment",type:"post",dataType:"json",data:{page:a,article_id:pageInfo.id},success:function(v){var g,h=parseInt(v.data.num%10),y=parseInt(v.data.num/10);g=h>0?y+1:y,0===v.result&&(g>a?$(".js-more").attr("data-page",a+1):$(".qa-comment-page").hide(),v=v.data,$(".df-title .comment-num i").html(v.num),0==v.num?$("#js-feedback-list-wrap").html('<p class="feedback-none">暂无评论</p>'):(curPage=parseInt(a),displayList(v.data,curPage,c)))},complete:function(){parsingLag(),initEvent(),""==$(".reply-box").html()&&$(this).css("padding-top","25px")}})},displayList=function(a,c,v){if(v){for(var s="",i=0,g=a.length;g>i;i++)s+=getHTML(a[i]);display(s)}else if(1==c&&a.length>4){for(var h="",$="",g=a.length,i=0;g>i;i++)i>3?$+=getHTML(a[i]):h+=3==i?getHTML(a[i],i):getHTML(a[i]);display(h,$)}else{for(var s="",i=0,g=a.length;g>i;i++)s+=getHTML(a[i]);display(s)}},getHTML=function(o,i){return i&&3==i?['<div class="comment-box clearfix" style="position:relative">',getComment(o,!0),getReplyBox(o.replys,o.comment_num,o.id),renderReleaseReply(user,o.uid),'<div class="moreBtn js-moreBtn">展开查看剩余评论</div>',"</div>"].join(""):['<div class="comment-box clearfix">',getComment(o,!0),getReplyBox(o.replys,o.comment_num,o.id),renderReleaseReply(user,o.uid),"</div>"].join("")},getComment=function(a){var c,v,g="",h="",$="";return c=a.upvoted?1==a.upvoted?'<span class="agree-with active l" data-commentid='+a.id+" data-uid="+a.uid+" data-username="+a.nickname+'><b class="imv2-thumb_up active-t-up"  title="已赞同"></b><em>'+a.support_num+"</em></span>":'<span class="agree-with l" data-commentid='+a.id+" data-uid="+a.uid+" data-username="+a.nickname+'><b class="imv2-thumb_up"  title="赞同"></b><em>'+a.support_num+"</em></span>":'<span class="agree-with l" data-commentid='+a.id+" data-uid="+a.uid+" data-username="+a.nickname+'><b class="imv2-thumb_up" title="赞同"></b><em>'+a.support_num+"</em></span>",1==a.mustar_switch&&(g='<i class="user-icon ismooc" title="慕星人"></i>'),1==a.is_author&&(h='<i class="user-icon great" title="认证作者"></i>'),2==a.user_type&&($='<i class="user-icon teacher" title="慕课网讲师"></i>'),v=user.uid==a.uid?"hide":"",['<div class="comment clearfix">','<div class="feed-author l">','<a href="/u/',a.uid,'/articles" >','<img src="',a.img,'" width="48" >','<span class="com-floor">',a.floor_num,"楼</span>","</a>","</div>",'<div class="feed-list-content">','<a class="nick" href="/u/',a.uid,'/articles" target="_blank">',a.nickname,"</a>",$,h,g,"<p>",a.content,"</p>",'<div class="comment-footer clearfix">',c,'<span class="reply-btn" data-commentid=',a.id," data-uid=",a.uid," data-username=",a.nickname,">回复","</span>",'<span class="report-btn js-tip-off tipoff ',v,'" data-id=',a.id," data-uid=",a.uid,' data-type="10" data-src="/article/',a.article_id,'">',"举报","</span>",'<span class="feed-list-times"> ',a.create_time,"</span>","</div>","</div>","</div>"].join("")},getReply=function(a){var c,v=function(a,c,v,g){return 0==_replyFlag?['<a href="/u/',a,'/articles" class="from-user">',v,"</a>："].join(""):a==c?['<a href="/u/',a,'/articles" class="from-user">',v,"</a>："].join(""):['<a href="/u/',a,'/articles" class="from-user">',v,"</a> 回复 ",'<a href="/u/',c,'/articles" class="to-user">',g,"</a>："].join("")};return c=user.uid==a.from_uid?"hide":"",['<div class="comment clearfix">','<div class="feed-author l">','<a href="/u/',a.from_uid,'/articles" >','<img src="',a.img,'" width="48" >',"</a>","</div>",'<div class="feed-list-content">','<span class="feed-list-time"> ',a.create_time,"</span>",v(a.from_uid,a.to_uid,a.from_username,a.to_username),"<p>",a.description,"</p>",'<div class="comment-footer clearfix">','<span class="reply-btn reply-btns "'," data-commentid=",a.reply_id," data-uid=",a.from_uid," data-username=",a.from_username,">回复","</span>",'<span class="report-btn js-tip-off tipoff ',c,'" data-id=',a.id," data-uid=",a.from_uid,'  data-type="11" data-src="/article/',a_id,'">',"举报</span>","</div>","</div>","</div>"].join("")},getAllReply=function(a){var c="";if(a&&a.length)for(var i=0;i<a.length;i++)c+=getReply(a[i]);return c},renderReleaseReply=function(a,c){return['<div class="release-reply clearfix">','<a href="/u/',a.uid,'/articles" class="user-head">','<img src="',OP_CONFIG.userInfo?OP_CONFIG.userInfo.head:"",'" alt="',OP_CONFIG.userInfo?OP_CONFIG.userInfo.nickname:"",'"/>',"</a>",'<div class="replay-con l">','<div class="textarea-wrap">','<textarea placeholder="写下你的回复..."></textarea>',"</div>",'<p class="errtip"></p>','<div class="reply-ctrl clearfix">','<div class="captcha-verify-box js-reply-verify-box hide"></div>','<div class="btn-wrap">','<div class="cancel-btn">取消</div>','<div data-comment-uid="',c,'" class="release-reply-btn">回复</div>',"</div>","</div>","</div>","</div>"].join("")},getMoreReply=function(a,c){return!a||1>a?"":['<div class="getMoreReply" data-replyid=',c,">点击展开后面 ","<span>",a,"</span> 条","</div>"].join("")},getReplyBox=function(a,c,v){var g=0;if(c&&(g=parseInt(c)-3),1>c)var h="hide";else var h="";return['<div class="reply-box'+h+'">',getAllReply(a),getMoreReply(g,v),"</div>"].join("")},display=function(a,c,v){var g=$("#js-feedback-list");g.length||($("#js-feedback-list-wrap .feedback-loading,#js-feedback-list-wrap .feedback-none").remove(),g=$('<div id="js-feedback-list"></div>').appendTo($("#js-feedback-list-wrap"))),g[v?"prepend":"append"](a),$(document).on("click",".js-moreBtn",function(){$(".js-moreBtn").addClass("hide"),$(".qa-comment-page").removeClass("hide"),$("#js-feedback-list").append(c)})},parsingLag=($(".df-title").offset().top+$(".df-ipt-wrap").height(),function(){uParse("body",{rootPath:"/static/component/base/ueditor/",chartContainerHeight:500})}),util={msg:function(a,c){var v=$(this).closest(".js-msg-context"),m=a?"addClass":"removeClass",g=c?"qa-tips-ok":"qa-tips-error";v.find(".qa-tips").removeClass("qa-tips-ok qa-tips-error")[m](g).html(a||"")},error:function(a,c){arguments.length<2&&(c=a,a=$(this).next(".errortip")),c?$(a).html(c):$(a).empty()}},initEvent=function(){var a={};a.reply_id=null,a.from_uid=null;var c=function(a,c){var v=$(window).height(),g=a.height(),h=a.offset().top,y=(v-g)/2;$("html,body").animate({scrollTop:h-y+"px"},c,"swing")};$(".replay-con textarea").on("succ",function(){$(this).parent().parent().find("p.errtip").text("")}).on("fail",function(e,a){$(this).parent().parent().find("p.errtip").text(a)}),$("#js-feedback-list-wrap").delegate(".reply-btn","click",function(){var v=$(this).parents(".comment-box"),g=$(this).attr("data-username");return isLogin?(v.find(".release-reply").fadeIn(),$(this).hasClass("reply-btns")?(_replyFlag=1,v.find("textarea").focus().val("回复 "+g+"：").attr("touser","回复 "+g+"：")):_replyFlag=0,a.reply_id=$(this).attr("data-commentid"),a.from_uid=$(this).attr("data-uid"),v.siblings(".comment-box").find(".cancel-btn").click(),c(v.find(".release-reply"),300),void clearVerify($(".js-reply-verify-box"))):void $("#js-signin-btn").click()}),$("#js-feedback-list-wrap").delegate(".cancel-btn","click",function(){var a=$(this).parents(".release-reply");a.find("textarea").trigger("succ").val(""),a.find(".verify-code").trigger("succ").html(""),a.css("display","none")}),$("#js-feedback-list-wrap").delegate(".release-reply-btn","click",function(e){var c=$(e.target),v=$(this);if(c.hasClass("release-reply-btn")){var g=v.parents(".comment-box").find(".replay-con"),h=v.parents(".comment-box").find(".reply-box"),y=v.parents(".comment-box").find("textarea"),j=(h.find(".getMoreReply").length>0?!0:!1,g.find(".js-reply-verify-box")),b=y.val();b=$.trim(b);var w=/^回复\s*\S+：/;if(w.test(b)?b=b.replace(w,""):a.from_uid=$.trim(c.attr("data-comment-uid")),b.length<3)return g.find("textarea").trigger("fail","回复内容不得少于3个字"),void clearVerify(j);if(b.length>300)return g.find("textarea").trigger("fail","回复内容不得多于300"),void clearVerify(j);g.find("textarea").trigger("succ"),$(".errtip").html("");var _={};_.reply_id=a.reply_id,_.from_uid=a.from_uid,_.description=b,"undefined"!=typeof token&&""!=token&&(_.token=token),c.addClass("disabled").html("回复..."),$.ajax({url:"/article/savereplycomment",data:_,type:"post",dataType:"json",success:function(a){if(0==a.result){var v=getReply(a.data),y=h.find(".comment").length;if(3>y)h.append(v);else{var b=h.find(".getMoreReply").length>0?!0:!1;b||h.append(v);var w=parseInt(h.find(".getMoreReply span").text());h.find(".getMoreReply span").text(w+1)}g.find(".cancel-btn").click(),clearVerify(j)}else-1==a.result&&1==a.data?(0!=$(".js-comment-verify-box").length&&clearVerify($(".js-comment-verify-box")),j.removeClass("hide"),moVerify=new mocaptcha(j,{type:0,success:function(t){token=t,c.trigger("click")}}),$(".js-mocaptcha").append('<span class="js-mocaptcha-close imv2-close"></span>')):-103002==a.result?(moVerify.reset(),token=""):-17==a.result?g.find("textarea").trigger("fail",a.msg):($.prompt(datas.msg,{icon:"error"}),""!=moVerify?(moVerify.reset(),token=""):clearVerify(j))},complete:function(){c.removeClass("disabled").html("回复")}})}}),$(".comment-box").on("click",function(e){var a=$(e.target);if(a.hasClass("getMoreReply")&&!a.hasClass("disabled")){var c=$(this).find(".reply-box"),v=$(e.target).attr("data-replyid");a.addClass("disabled").html("请稍等...");var g={};g.reply_id=v,g.page=2,$.ajax({url:"/article/getcomment",data:g,type:"post",dataType:"json",success:function(v){if(0==v.result){for(var g=v.data,h="",i=0;i<g.length;i++)h+=getReply(g[i]);a.remove(),c.append(h)}else a.remove()},complete:function(){}})}})};$(".detail-feedback-wrap").delegate(".agree-with","click",function(){if(!isLogin)return void $("#js-signin-btn").click();var a=$(this).attr("data-commentid"),c=$(this),v=c.hasClass("active");c.hasClass("loading")||(c.addClass("loading"),$.ajax({url:"/article/ajaxupvotecomment",type:"post",dataType:"json",data:{comment_id:a},success:function(a){if(0==a.result&&!v){c.addClass("active");var g=c.find("em"),h=parseInt(g.text());h+=1,g.text(h),c.find("b").addClass(v?"":"active-t-up").attr("title",v?"赞同":"已赞同")}},complete:function(){}}))}),$(document).on("mouseover",".comment",function(){1==isLogin?$(this).find(".report-btn").hasClass("hide")||$(this).find(".report-btn").css("display","block"):$(this).find(".report-btn").css("display","n")}),$(document).on("mouseout",".comment",function(){1==isLogin&&($(this).find(".report-btn").hasClass("hide")||$(this).find(".report-btn").css("display","none"))});var loadArticleList=function(a){a=a||1;var c=pageInfo.id,v=$(".js-title").text();$.ajax({url:"//www.imooc.com/search/articledetail",type:"post",dataType:"json",data:{page:a,word:v,aid:c},success:function(c){$(".js-feed-loading").attr("data-page",a-0+1),renderArticleList(c.data)}})},column_name=$(".js-column").text(),hasrender=!1,renderArticleList=function(a){var c="";return a=={}?($(".article_wrap").hide(),0):($.each(a,function(v,g){if("skills"==v)return!1;var h="",y="",j="";!hasrender&&"10"==v&&a.skills&&($.each(a.skills,function(i,a){y+='<li class="l"><a href="/article/tag/'+a.label_id+'" target="_blank">'+a.name+"</a></li>"}),j+='<ul class="clearfix">'+y+"</ul>",hasrender=!0),g.skills&&$.each(g.skills,function(a,c){h+='<a href="/article/tag/'+c.id+'" target="_blank" ><span>'+c.name+"</span><a>",a!=g.skills.length-1&&(h+='<i class="imv2-dot_samll"></i>')}),c+=j+'<div class="article clearfix">                    <div class="imgCon l">                        <img src="'+g.pic+'">                    </div>                    <div class="list-content l">                        <a href="/article/'+g.id+'" target="_blank" class="title"><p>'+g.title+'</p></a>                        <div class="list-bottom clearfix">                            <div class="labels-area l clearfix">                                <div class="browseNum l">                                    <i class="imv2-visibility"></i>                                    <span>'+g.view_num+'</span>                                </div>                                <div data-fuid="'+g.uid+'" class="nickName l js-usercard-dialog" data-userid="'+g.uid+'">'+g.nickname+'</div>                                <span class="skill clearfix">'+h+'</span>                        </div>                            <div class="createTime r">'+g.show_time+"</div>                        </div>                    </div>                </div>"}),void $(".js-articleCon").append(c))},downData=function(a){var c=".js-feed-loading",v=$(c).attr("data-page");11==v?setTimeout(function(){$(c).css("padding-left",0);var v='进入<a href="/article/'+marking+'" target="_blank">'+column_name+"栏目</a>查看更多内容";$(c).html(v),a&&a(!0)},1e3):(loadArticleList(v-0),a&&a(!1))},init=function(){var a=!1,c=$(".js-feed-loading");$(document).scroll(function(){var v=$(this).scrollTop();a||Math.ceil(v)>=$(this).height()-$(window).height()&&(a=!0,c.show(),downData(function(c){setTimeout(function(){c||(a=!1)},1e3)}))}),loadFeedback(),loadArticleList(),showAuthors(),showPraiseUser(),initCodePreview();var v=/^https:\/\/([\w\-]+(\.[\w\-]+)*\/)*[\w\-]+(\.[\w\-]+).*(\.png|\.jpg|\.jpeg|\.gif)$/;$(".js-lookimg img").each(function(){var a=$(this).attr("alt");v.test(a)&&$(this).attr("data-src",a)}),moco.imagePreview.init(".js-lookimg"),moco.imagePreview.init(".js-feedback-lookimg .feed-list-content",!0)};init(),$("#js-praise-bottom,#js-praise-left").click(function(){if(!OP_CONFIG.userInfo)return void seajs.use("login_sns",function(a){a.init()});var a=$(this).find("span"),p=a.hasClass("praised");$("#js-praise").hasClass("loading")||($("#js-praise").addClass("loading"),$.ajax({url:"/article/ajaxupvote",type:"post",dataType:"json",data:{article_id:pageInfo.id},success:function(a){if(0===a.result&&!p){$("#js-praise-bottom").css("background","#ffaa00").find("span").addClass("praised"),$("#js-praise-left").css("background","#ffaa00").find("span").addClass("praised"),$("#js-praise").css("background","#ffaa00").find("span").addClass("praised");var c=$(".praise-box .num-person .num",".praise-box .praise-num"),v=parseInt(pageInfo.praiseNum);v+=1,c.html(v),$(".praise-share").removeClass("hide")}},complete:function(){$("#js-praise").removeClass("loading")}}))}),$(".js-follow").click(function(){if(!OP_CONFIG.userInfo)return void seajs.use("login_sns",function(a){a.init()});var a=$(this),p=a.hasClass("active-star");a.hasClass("loading")||(a.addClass("loading"),$.ajax({url:p?"/article/ajaxdelcollect":"/article/ajaxcollect",type:"post",dataType:"json",data:{article_id:pageInfo.id},success:function(a){0===a.result?($(".js-follow")[p?"removeClass":"addClass"]("active-star"),$(".js-follow").next("span").text(p?"收藏":"已收藏")):$.prompt(a.msg,{icon:"error"})},complete:function(){a.removeClass("loading")}}))});var doing=!1,forward=function(){if(0==pageInfo.canForward)return $.prompt("文章暂未通过审核，不可转发",{icon:"error"}),!1;var a=Common.Template.detailForwardTpl,c=$.dialog(a,{modal:!0,title:"转发文章"}),v=c.boxy.find(".js-publish-textarea").focus(),g=c.boxy.find(".js-publish-count");$.limitInput(v,Common.MaxLength,function(a){g.html(a+"/"+Common.MaxLength),a>Common.MaxLength?g.addClass("red"):g.removeClass("red")}),c.boxy.find(".js-forward-submit").on("click",function(){if(doing)return 0;doing=!0,$(".js-forward-submit").text("提交中...");var a=v.val();return $.getLength(a)>Common.MaxLength?($.prompt("最多"+Common.MaxLength+"个字符",{icon:"error"}),doing=!1,void $(".js-forward-submit").text("提交")):(""==a&&(a="这是一篇还不错的文章，有兴趣可以看看"),void sendForward(c,{id:dtid,content:a}))})},sendForward=function(a,c){$.ajax({url:Common.API.forward,type:"post",data:c,dataType:"json",success:function(c){0===c.result?(doing=!1,$(".js-forward-submit").text("提交"),$.prompt("转发成功",{callback:function(){a.hide()}})):($.prompt(c.msg,{icon:"error"}),-2==c.result&&a.hide())},error:function(){doing=!1,$.prompt("转发失败",{icon:"error"})}})};$(".js-forward-btn").on("click",function(){return OP_CONFIG.userInfo?void forward():void seajs.use("login_sns",function(a){a.init()})}),$(".js-close").on("click",function(){$(".js-tip").hide()}),$(window).on("scroll",function(){var a=$(this).scrollTop(),c=$(".js-part_essay").outerHeight(!0);a>c?($(".js-active-fixed").addClass("hide"),$(".js-bottom-fixed").removeClass("hide")):($(".js-active-fixed").removeClass("hide"),$(".js-bottom-fixed").addClass("hide"));var v=$(".js-author_info").outerHeight(!0)+$(".js-other_article").outerHeight(!0)+$("#header").outerHeight(!0)+$("#sub-header").outerHeight(!0);a>v?$(".js-related_lessons").addClass("js-fixed"):$(".js-related_lessons").removeClass("js-fixed")});var articlename=$.trim($(".detail-title .d-t").text()),imgPic=$("#js-share-img").attr("data-pic"),upic=$("#js-img-author").attr("data-pic"),isOriN=$.trim($(".detail-title span.type").text()),isOri=isOriN?isOriN+"_":"";with(title="分享："+articlename+"@慕课网 "+isOri+"慕课网_手记",link="https://www.imooc.com"+window.location.pathname,$.trim(imgPic)||(imgPic=upic),-1==imgPic.indexOf(".jpg")&&(imgPic="https://img.mukewang.com/"+imgPic+".jpg"),window._bd_share_config={common:{bdUrl:link,bdSnsKey:{tsina:"2788596354"},bdText:title,bdMini:"2",bdMiniList:!1,bdPic:imgPic,bdStyle:"0",bdSize:"16",searchPic:""},share:{}},document)0[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="/static/lib/baiduShare/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date/36e5)];shareFrame=$(".js-share-statue"),setTimeout(function(){shareFrame.hide()},5e3);var timer,shareEles=$(".bdsharebuttonbox a.share-icon,.share-list a.share-icon"),sendId=pageInfo.id,ajaxing=0,interval=1;shareEles.on("click",function(e){ajaxing||(ajaxing=1,shareFrame.hide(),$.ajax({type:"post",url:"/course/courseshare",data:"id="+sendId+"&type=5",success:function(){ajaxing=0},error:function(){layer.msg("网络错误，请稍后再试",1,1)},complete:function(){isAjax=0}}),e.preventDefault())}).mouseenter(function(){shareFrame.show()}).mouseleave(function(){timer&&clearTimeout(timer),timer=setTimeout(function(){shareFrame.hide()},interval)});$(document).mouseup(function(e){var a=$("#bdshare_weixin_qrcode_dialog");a.is(e.target)||0!=a.has(e.target).length||(a.hide().remove(),$("#bdshare_weixin_qrcode_dialog_bg").attr("display","none").remove())}),$("#js-text-login").click(function(){return OP_CONFIG.userInfo?void 0:void seajs.use("login_sns",function(a){a.init()})}),$(document).on("click",".js-mocaptcha-close",function(){$(".captcha-verify-box").addClass("hide").html(""),token=""});var clearVerify=function(a){a.addClass("hide").html(""),token=""},moVerify=""});